<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Customers</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/style.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        primary: '#FF4C29',
                        secondary: '#2C3E50',
                        dark: '#0f172a',
                        card: '#1e293b',
                    },
                }
            }
        }
    </script>
</head>

<body class="bg-dark text-white font-sans min-h-screen">

    <!-- Mobile Header -->
    <div class="md:hidden flex items-center justify-between p-4 glass-nav border-b border-white/10 sticky top-0 z-50">
        <h1 class="text-xl font-bold tracking-tight text-white app-company-name">ADMIN <span
                class="text-primary">PANEL</span></h1>
        <button onclick="toggleSidebar()" class="p-2 text-white hover:bg-white/10 rounded-lg transition-colors">
            <i data-lucide="menu" class="w-6 h-6"></i>
        </button>
    </div>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" onclick="toggleSidebar()"
        class="fixed inset-0 bg-black/80 z-30 hidden md:hidden glass-backdrop"></div>

    <!-- Sidebar -->
    <aside id="admin-sidebar"
        class="fixed inset-y-0 left-0 w-64 glass-card border-r border-white/10 z-40 transform -translate-x-full md:translate-x-0 transition-transform duration-300 flex flex-col h-full bg-dark/95 backdrop-blur-xl">
        <div class="h-20 flex items-center px-6 border-b border-white/10">
            <h1 class="text-xl font-bold tracking-tight text-white app-company-name">ADMIN <span
                    class="text-primary">PANEL</span></h1>
        </div>
        <nav class="flex-1 p-4 space-y-2">
            <a href="admin_dashboard.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                Dashboard
            </a>
            <a href="admin_dashboard.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors">
                <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                Orders
            </a>
            <a href="admin_customers.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary/20 text-primary font-medium">
                <i data-lucide="users" class="w-5 h-5"></i>
                Customers
            </a>
            <a href="admin_config.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors">
                <i data-lucide="settings" class="w-5 h-5"></i>
                Site Config
            </a>
            <a href="admin_products.html"
                class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors">
                <i data-lucide="package" class="w-5 h-5"></i>
                Manage Products
            </a>
        </nav>
        <div class="p-4 border-t border-white/10">
            <button onclick="logout()"
                class="flex items-center gap-3 px-4 py-3 w-full rounded-lg hover:bg-red-500/10 text-red-500 transition-colors">
                <i data-lucide="log-out" class="w-5 h-5"></i>
                Logout
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="md:ml-64 p-4 md:p-8 pt-8 md:pt-8">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h2 class="text-3xl font-bold text-white">Customers</h2>
                <p class="text-gray-400">View customer details extracted from orders.</p>
            </div>
            <!-- Export or other actions could go here -->
        </header>

        <div class="glass-card rounded-2xl overflow-hidden border border-white/10">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-white/5 text-gray-400 text-sm uppercase font-medium">
                        <tr>
                            <th class="px-6 py-4">Name</th>
                            <th class="px-6 py-4">Phone Numbers</th>
                            <th class="px-6 py-4">Address</th>
                            <th class="px-6 py-4 text-center">Total Orders</th>
                            <th class="px-6 py-4 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5 text-sm" id="customers-table-body">
                        <!-- Rows injected via JS -->
                    </tbody>
                </table>
            </div>

            <div id="empty-state" class="hidden p-12 text-center text-gray-500">
                <i data-lucide="users" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                <p>No customers found yet.</p>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            if (!localStorage.getItem('rubik_admin_session')) {
                window.location.href = 'admin_login.html';
            }
            renderCustomers();
        });

        function renderCustomers() {
            const orders = JSON.parse(localStorage.getItem('rubik_orders')) || [];
            const tbody = document.getElementById('customers-table-body');
            const emptyState = document.getElementById('empty-state');

            // Extract unique customers based on Mobile Number (primary key simulation)
            const customersMap = new Map();

            orders.forEach(order => {
                const mobile = order.customer.mobile1;
                if (!customersMap.has(mobile)) {
                    customersMap.set(mobile, {
                        name: order.customer.name,
                        mobile1: order.customer.mobile1,
                        mobile2: order.customer.mobile2,
                        address: order.customer.address,
                        orderCount: 0,
                        lastOrderDate: order.date
                    });
                }
                customersMap.get(mobile).orderCount++;
            });

            const customers = Array.from(customersMap.values());

            if (customers.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            tbody.innerHTML = customers.map(c => `
                <tr class="hover:bg-white/5 transition-colors group">
                    <td class="px-6 py-4">
                        <div class="font-medium text-white">${c.name}</div>
                        <div class="text-xs text-gray-500">Last Active: ${new Date(c.lastOrderDate).toLocaleDateString()}</div>
                    </td>
                    <td class="px-6 py-4 text-gray-300">
                        <div>${c.mobile1}</div>
                        ${c.mobile2 ? `<div class="text-xs text-gray-500">${c.mobile2}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 text-gray-300 max-w-xs truncate" title="${c.address}">
                        ${c.address}
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-primary/20 text-primary font-bold">
                            ${c.orderCount}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right">
                         <a href="tel:${c.mobile1}" class="p-2 text-green-500 hover:bg-green-500/10 rounded-lg transition-colors inline-block" title="Call">
                            <i data-lucide="phone" class="w-4 h-4"></i>
                        </a>
                    </td>
                </tr>
            `).join('');
            lucide.createIcons();
        }

        function logout() {
            localStorage.removeItem('rubik_admin_session');
            window.location.href = 'admin_login.html';
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('admin-sidebar');
            const overlay = document.getElementById('sidebar-overlay');

            if (sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }
    </script>
    <script src="assets/js/data.js"></script>
</body>

</html>